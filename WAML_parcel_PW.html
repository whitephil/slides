<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Parcels in Practice</title>

		<meta name="description" content="Presentation on 10-10-2024 at WAML Virtual Symposium">
		<meta name="author" content="Phil White>

		<meta name="reveal" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="creator" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/port_style.css" id="theme">

		<!-- emoji style -->
		<link href="https://emoji-css.afeld.me/emoji.css" rel="stylesheet">

		<style>

		#left_slide {
			text-align: left;}

		p.small {
			line-height: 0.5;
		}

		p.pad_left {
			padding-left: 2em;
		}
		</style>

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
	</head>

	<body>

		<div class="reveal">
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section data-background-color='#6E7B8B'>
					<h3 style="text-align: left; color:white; font-size:40px">Parcel Data in Practice: Processing Big Data in a Self-Managed, Open Source Environment.</h3>
					<p style="text-align: left; color:white; font-size:35px">WAML Virtual 2024</p><br><br>
						<div style="text-align: right;">
							<p style='color:white'><strong>Phil White</strong></p>
							<p class="small" style='color:white; font-size:30px'>Earth, Environment & Geospatial Librarian</p>
							<p class="small" style='color:white; font-size:30px'>University of Colorado Boulder Libraries</p>
							<p class="small" style='font-size:30px'><a href='mailto:philip.white@colorado.edu' style='color:#9BCD9B'>philip.white@colorado.edu</a></p>
							<p class="small"><a href='https://whitephil.github.io/slides/WAML_parcel_PW' target='_blank' style='color:#9BCD9B; font-size:30px'>whitephil.github.io/slides/WAML_parcel_PW</a></p>
						</div>
				</section>


				<section data-background-color='#6E7B8B'>
					<h2 style='color:white'>Background <i class="em em-rewind" aria-role="presentation" aria-label="BLACK LEFT-POINTING DOUBLE TRIANGLE"></i></h2>
				</section>

				<section>
					<div id='left_slide'>
						<h4>May 2021 Email from a professor (paraphrased)</h4>
						<p>How are mobile home park transactions affecting residents financially?</p>
						<p class="fragment pad_left" style="font-size:30px"><a target=_blank href="https://www.newyorker.com/magazine/2021/03/15/what-happens-when-investment-firms-acquire-trailer-parks"><i>New Yorker</i> article from March 2021</a></p>
							<ul>
								<li class='fragment'>Do we own a national parcel data layer?</li>
								<li class='fragment'>What are the GIS steps needed to merge census data with parcel data?</li>
								<li class='fragment'>I am not trained in GIS, who can help?</li>
							</ul>
				</section>
				<section data-background-color='#6E7B8B'>
					<h2 style='color:white'>Parcel Data <i class="em em-hocho" aria-role="presentation" aria-label="HOCHO"></i></h2>
				</section>

				<section>
					<div id='left_slide'>
						<h4>Parcel Data</h4>
						<ul style='font-size:35px'>
							<li class="fragment">Often available for free from your county government or tax assessor in GIS format.</li><br>
							<li class="fragment">However, it's unreasonable to go download data 2500–3000 different counties.</li><br>
							<li class="fragment">Not all 3143 US counties make them available; some only sell their data.</li><br>
							<li class="fragment">Where to buy it? And how much is it?</li><br>
							<li class="fragment">FY21–22 we acquired parcel data for 2600+ US counties (of 3143). Available in AGO and got the full dataset on a drive.</li>
						</ul>
					</div>

				</section>

				<section data-background-image="img/WAML_1.png">
				</section>

				<section data-background-image="img/WAML_2.png">
				</section>

				<section data-background-image="img/WAML_3.png">
				</section>

				<section>
					<div id='left_slide'>
						<h4>Conceptual Workflow:</h4>
						<ol style="font-size:32px;">
							<br>
							<li class="fragment"><a href='https://hifld-geoplatform.hub.arcgis.com/datasets/4cdbccc5c538452aa91ceee277c460f9_0/explore?location=37.385238%2C-97.049797%2C7.13' target="_blank">Mobile homes point data for US</a></li><br>
							<li class="fragment">Spatial join to parcel data to isolate mobile home parcels</li><br>
							<li class="fragment">Union MH parcels with Census Blocks and determine proportions of blocks within parcels</li><br>
							<li class="fragment">Add numeric census data (income, etc)</li><br>
							<li class="fragment">Regression analysis to test hypothesis</li>
						</ul>
				</section>

				<section data-background-color="#32CD32">
					<h2>Simple right <i class="em em-interrobang" aria-role="presentation" aria-label="EXCLAMATION QUESTION MARK"></i></h2>
				</section>

				<section data-background-image="img/WAML_4.png">
				</section>

				<section data-background-image="img/WAML_5.png">
				</section>

				<section data-background-image="img/WAML_6.png">
				</section>

				<section data-background-image="img/WAML_7.png">
				</section>


				<section data-background-image="img/WAML_8.png">
				</section>


				<section>
					<div id='left_slide'>
						<h4>Initial Efforts</h4>
						<ul style='font-size:30px'>
							<li class="fragment">I initially advised professor that, owing to scale, automation would be necessary.</li><br>
							<li class="fragment">Meanwhile, I ended up teaching GEOG 5303: GIS Programming, spring 2022.</li><br>
							<li class="fragment">Bright idea: "Let's hire one of my students to do this work!" (spring 2023)</li><br>
						</ul>
					</div>
				</section>

				<section>
					<div id='left_slide'>
						<h4>Initial Efforts</h4>
						<ul style='font-size:30px'>
							<li class="fragment">This was far too complicated for a student to complete in a semester.</li><br>
							<li class="fragment">Result: "Okay, I'll do it... can't be too hard right?"</li><br>
							<li class="fragment">Convert all code to open source. Python of course.</li><br>
							<li class="fragment">Started developing data processing pipeline using Colorado as the test data.</li><br>
							<li class="fragment">Myriad data complications that needed to be accounted for in the process.</li><br>
							<li class="fragment">Even with a programmatic approach, simply iterating over counties/states resulted in extremely long run times.</li><br>
						</ul>
					</div>
				</section>

				<section>
					<h2>Complications <i class="em em-thinking_face" aria-role="presentation" aria-label="THINKING FACE"></i></h2>
				</section>

				<section>
					<div id='left_slide'>
						<h4>Myriad Complications</h4>
						<ul class="fragment" style='font-size:20px'>
							<li>Roads as parcels: filter out complex geoms</li>
							<li>Stacked parcels: deduplicate</li>
							<li>Inaccurate MH points: near join</li>
							<li>But, sometimes nearest parcel is the wrong one</li>
							<li>Mobile Home park exists on multiple parcels: one to many join</li>
							<li>One to many join results in getting all parcels within a radius, not just MH parcels</li>
							<li>Had to incorporate nationwide buildings data to filter parcels that did not look like MH parks</li>
							<li>How many buildings on a parcel? What's the average building size?</li>
							<li>Oh by the way, need to use 2000 and 2010 census blocks</li>
							<li>Oh by the way, we have two different mobile home park datasets</li><br>
						</ul>
						<p class="fragment" style="font-size:30px">Nationwide parcels + (nationwide Census blocks * 2) + nationwide buildings + (mhp points * 2) = Terabytes of inputs</p>
					</div>
				</section>


				<section data-background-image="img/WAML_9.png">
				</section>

				<section data-background-image="img/WAML_10.png">
				</section>

				<section data-background-image="img/WAML_11.png">
				</section>

				<section data-background-image="img/WAML_12.png">
				</section>

				<section data-background-image="img/WAML_13.png">
				</section>

				<section data-background-image="img/WAML_14.png">
				</section>

				<section data-background-image="img/WAML_15.png">
				</section>

				<section data-background-image="img/WAML_16.png">
				</section>

				<section data-background-image="img/WAML_17.png">
				</section>

				<section data-background-image="img/WAML_18.png">
				</section>

				<section>
					<div id="left_slide">
						<h4>Processing steps, briefly</h4>
						<ul class="fragment" style="font-size:15px">
							<li>Read in parcels, buildings, MH data 1, MH data 2</li>
							<li>Manage coordinate system transformations as needed</li>
							<li>Remove stacked/duplicate parcels based on geometries</li>
							<li>Remove none type geometries</li>
							<li>Count buildings within parcels</li>
							<li>Calculate mean building size per parcel</li>
							<li>Simplify parcel geometries</li>
							<li>Count number of vertices in interior geometries and exterior geometries</li>
							<li>Calculate z-score of lengths of interior and exterior geometries to find outlier parcels</li>
							<li>Drop outlier geometries</li>
							<li>Drop parcels with fewer than five buildings</li>
							<li>Drop parcels where mean building area is greater than 175 m sq</li>
							<li>Attempt join by APN field if present</li>
							<li>Join nearest parcel to point (50m)</li>
							<li>Join all next nearest parcels to point (100m)</li>
							<li>Sum number of buildings across all parcels associated with one MHP</li>
							<li>Compare number of buildings in all parcels per MH to input point data unit count</li>
							<li>Drop furthest parcels when building count exceeds 15% of unit count</li>
							<li>Repeat all steps for second MHP data set</li>
							<li>Manage all attribute fields</li>
							<li>Read in 2000 Census blocks, 2010 Census blocks</li>
							<li>Perform union overlay operation on parcels and census blocks</li>
							<li>Calculate ratio of block within parcel to full block</li>
							<li>Repeat for second Census data set</li>
							<li>Store outputs in geopackage</li>
							<li>Merge output geospatial data table with original mobile home park data table</li>
							<li>Manage attribute field data</li>
							<li>Repeat for second parcel/mhp/census data set</li>
							<li>Output all versions as CSV</li>
						</ul>
					</div>
					<p style="font-size:25" class="fragment">I think...</p>
				</section>
				
				<section>
					<div id='left_slide'>
						<h3>6 months later</h3>
						<ul>
							<li class="fragment">Data processing pipeline complete.</li><br>
							<li class="fragment">Successful join rate: ~80–90% (Colorado)</li><br>
							<li class="fragment">Among those, 96% accuracy</li><br>
							<li class="fragment">But... </li>
						</ul>
					</div>
				</section>

				<section data-background-color="#1E90FF">
					<h2 style="color:white;">Next problem: scaling <i class="em em-rocket" aria-role="presentation" aria-label="ROCKET"></i></h2>
				</section>

				<section>
					<div id='left_slide'>
						<h3>Parallel Processing</h3>
						<ul style="font-size:30px">
							<li class="fragment">During development, managed to reduce time for all Colorado counties to around 6 minutes using a parallel processing approach.</li><br>
							<li class="fragment">Essentially, split all of your data into buckets (counties for me), run them concurrently instead of sequentially.</li><br>
							<li class="fragment">How many depends on your processor; I could run 16 counties at a time on my laptop.</li><br>
							<li class="fragment">Still would take too long for entire nation.</li>
						</ul>
					</div>
				</section>

				<section>
					<div id='left_slide'>
						<h3>High Performance Computing, January 2024</h3>
						<ul style="font-size:30px">
							<li class="fragment">aka: super computing</li><br>
							<li class="fragment">CU Boulder has a super-computing cluster (Linux, SLURM)</li><br>
							<li class="fragment">Set up: split all data into bins (file directories) one per county</li><br>
							<li class="fragment">Lots of accessory scripts to move parcel data, download census data, download and split buildings data into county directories</li><br>
							<li class="fragment">Execute using bash scripting</li><br>
							<li class="fragment">Easier than it sounds!</li>
						</ul>
					</div>
				</section>

				<section data-background-color="black">
					<img src="img/WAML.gif" height="500">
				</section>

				<section>
					<div id="left_slide">
						<h3>June 2024</h3>
						<ul style="font-size:30px">
							<li class="fragment">Ran the parcel data pipeline algorithm on 2600+ counties on HPC.</li><br>
							<li class="fragment">Able to run up to 1000 concurrently.</li><br>
							<li class="fragment">Took a few hours to run.</li><br>
							<li class="fragment">Took about a year to develop.</li><br>
							<li class="fragment">The project continues!</li><br>
							<li class="fragment">Hope to have a paper out of this some day... </li>
						</ul>
					</div>
				</section>

				<section data-background-color="#1E90FF">
					<h2 style="color:white;">Why am I sharing all of this? <i class="em em-thought_balloon" aria-role="presentation" aria-label="THOUGHT BALLOON"></i></h2>
				</section>

				<section>
					<div id="left_slide">
						<h3>Not just flexin'... Some implications!</h3>
						<ul style="font-size:30px">
							<li class="fragment">Open source is essential for libraries.</li><br>
							<li class="fragment">Librarians working in this space need to know open source options, including programming languages.</li><br>
							<li class="fragment">Would this have been possible using 'Data as a Service' model? I think not.</li><br>
							<li class="fragment">There is a place for DaaS... But, not a true replacement for owning the data.</li><br>
							<li class="fragment">Finally, parcel data comes with a a host of complications--I hope this helps!</li>
						</ul>
					</div>
				</section>

				<section data-background-color="#1E90FF">
					<h3 style="color:white">The End. <i class="em em-baseball" aria-role="presentation" aria-label="BASEBALL"></i></h3>
				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/zoom/zoom.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/search/search.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>

			// Also available as an ES module, see:
			// https://revealjs.com/initialization/
			Reveal.initialize({
				controls: true,
				progress: true,
				center: true,
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight ]
			});

		</script>

	</body>
</html>
